<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Enquiry Form Plugin: C:/Users/nashc/GitHub Projects/Enquiry-Form/includes/ef-functions.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Enquiry Form Plugin<span id="projectnumber">&#160;0.8.3 Dev</span>
   </div>
   <div id="projectbrief">A simple and customizable WordPress plugin that extends WooCommerce functionality by adding an enquiry system for products. Users can select items, add them to an enquiry cart, and submit their inquiries via a form.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('ef-functions_8php_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">ef-functions.php</div></div>
</div><!--header-->
<div class="contents">
<a href="ef-functions_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span>&lt;?php</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Don&#39;t allow direct access to the file</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a4396f386cfc67c374995142b444e3ed2">    3</a></span><span class="keywordflow">if</span> (!defined(<span class="stringliteral">&#39;ABSPATH&#39;</span>)) {</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>    exit;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span>}</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">// Include class files</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>require_once <a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;includes/class-ef-post-type.php&#39;</span>;</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>require_once <a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;includes/class-ef-db.php&#39;</span>;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>require_once <a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;includes/class-ef-email.php&#39;</span>;</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>require_once <a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;includes/class-ef-logger.php&#39;</span>;</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>require_once <a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;includes/class-ef-caching.php&#39;</span>;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="foldopen" id="foldopen00014" data-start="{" data-end="}">
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#af77ad260294f48ad7089cd9514a51128">   14</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#af77ad260294f48ad7089cd9514a51128">ef_process_form_data</a>($form_data) {</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span>        <a class="code hl_function" href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger::log</a>(<span class="stringliteral">&#39;Processing form data&#39;</span>, <a class="code hl_variable" href="class_e_f___logger.html#af2d1bd27ecbe33ecaadb558404e9c669">EF_Logger::INFO</a>, [<span class="stringliteral">&#39;data&#39;</span> =&gt; $form_data]);</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>        </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>        <span class="keywordflow">if</span> (empty($form_data[<span class="stringliteral">&#39;email&#39;</span>]) || empty($form_data[<span class="stringliteral">&#39;name&#39;</span>])) {</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Required fields are missing&#39;</span>);</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>        }</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>        </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>        $sanitized_data = <a class="code hl_function" href="ef-functions_8php.html#a9d3e1fd403ae0b51ab19003b4ec2edd0">ef_sanitize_form_data</a>($form_data);</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>        </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>        <span class="comment">// Validate the sanitized data</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>        $validation_errors = <a class="code hl_function" href="ef-functions_8php.html#a42c092d9cd75e88e9d8646c31e5e4bf6">ef_validate_form_data</a>($sanitized_data);</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>        <span class="keywordflow">if</span> (!empty($validation_errors)) {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Validation failed: &#39;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $validation_errors));</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        }</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>        </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>        $insert_result = <a class="code hl_function" href="ef-functions_8php.html#ace887820ee00c2a6bf5a026d621a308b">ef_save_form_data</a>($sanitized_data);</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>        </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>        <span class="keywordflow">if</span> ($insert_result) {</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>            <span class="comment">// Save cart items to the sanitized data for email use</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>            $sanitized_data[<span class="stringliteral">&#39;cart_items&#39;</span>] = WC()-&gt;cart-&gt;get_cart();</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>            </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>            <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>                $confirmation_result = <a class="code hl_function" href="ef-functions_8php.html#a20376de7367c72554328fcc717433c8f">ef_send_confirmation_email</a>($sanitized_data);</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>                $notification_result = <a class="code hl_function" href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">ef_send_notification_email</a>($sanitized_data);</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                <a class="code hl_function" href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger::log</a>(</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                    <span class="stringliteral">&#39;Email sending results&#39;</span>,</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>                    <a class="code hl_variable" href="class_e_f___logger.html#af2d1bd27ecbe33ecaadb558404e9c669">EF_Logger::INFO</a>,</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                    [</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                        <span class="stringliteral">&#39;confirmation&#39;</span> =&gt; $confirmation_result,</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                        <span class="stringliteral">&#39;notification&#39;</span> =&gt; $notification_result</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                    ]</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>                );</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>                </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                <span class="keywordflow">if</span> (!$confirmation_result || !$notification_result) {</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>                    <a class="code hl_function" href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger::log</a>(</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                        <span class="stringliteral">&#39;Email sending failed&#39;</span>,</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                        <a class="code hl_variable" href="class_e_f___logger.html#ad0c7ccd2f8b92a760391d21d0ec7b339">EF_Logger::WARNING</a>,</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                        [<span class="stringliteral">&#39;error&#39;</span> =&gt; <a class="code hl_function" href="class_e_f___email.html#aee6c90f2128e575740685ec3b813140a">EF_Email::get_last_error</a>()]</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                    );</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                }</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>            } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>                <a class="code hl_function" href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger::log</a>(</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                    <span class="stringliteral">&#39;Email sending error&#39;</span>,</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>                    <a class="code hl_variable" href="class_e_f___logger.html#a7f79d7b73cfb40bb7855d4260393cc0f">EF_Logger::ERROR</a>,</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>                    [<span class="stringliteral">&#39;error&#39;</span> =&gt; $e-&gt;getMessage()]</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>                );</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            }</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <span class="comment">// Clear the cart after all operations are complete</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;WC&#39;</span>) &amp;&amp; isset(WC()-&gt;cart)) {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>                WC()-&gt;cart-&gt;empty_cart();</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            }</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>            <span class="keywordflow">return</span> array(</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                <span class="stringliteral">&#39;success&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>                <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;show_thank_you_popup&#39;</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            );</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Failed to save form data&#39;</span>);</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <a class="code hl_function" href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger::log</a>(</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            <span class="stringliteral">&#39;Form processing error&#39;</span>,</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <a class="code hl_variable" href="class_e_f___logger.html#a7f79d7b73cfb40bb7855d4260393cc0f">EF_Logger::ERROR</a>,</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            [</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>                <span class="stringliteral">&#39;error&#39;</span> =&gt; $e-&gt;getMessage(),</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                <span class="stringliteral">&#39;trace&#39;</span> =&gt; $e-&gt;getTraceAsString()</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            ]</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        );</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        <span class="keywordflow">return</span> array(</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            <span class="stringliteral">&#39;success&#39;</span> =&gt; <span class="keyword">false</span>,</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="stringliteral">&#39;message&#39;</span> =&gt; <span class="stringliteral">&#39;An error occurred while processing your enquiry. Please try again later.&#39;</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        );</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    }</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>}</div>
</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="foldopen" id="foldopen00094" data-start="{" data-end="}">
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#ace887820ee00c2a6bf5a026d621a308b">   94</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#ace887820ee00c2a6bf5a026d621a308b">ef_save_form_data</a>($form_data) {</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    global $wpdb;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    $enquiries_table = $wpdb-&gt;prefix . <span class="stringliteral">&#39;ef_enquiries&#39;</span>;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    $cart_items_table = $wpdb-&gt;prefix . <span class="stringliteral">&#39;ef_cart_items&#39;</span>;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    $result = $wpdb-&gt;insert(</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        $enquiries_table,</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        array(</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <span class="stringliteral">&#39;subject&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;subject&#39;</span>]),</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            <span class="stringliteral">&#39;content&#39;</span> =&gt; sanitize_textarea_field($form_data[<span class="stringliteral">&#39;content&#39;</span>]),</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            <span class="stringliteral">&#39;name&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;name&#39;</span>]),</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="stringliteral">&#39;company&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;company&#39;</span>]),</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <span class="stringliteral">&#39;email&#39;</span> =&gt; sanitize_email($form_data[<span class="stringliteral">&#39;email&#39;</span>]),</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            <span class="stringliteral">&#39;phone&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;phone&#39;</span>]),</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            <span class="stringliteral">&#39;created_at&#39;</span> =&gt; current_time(<span class="stringliteral">&#39;mysql&#39;</span>),</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            <span class="stringliteral">&#39;processed&#39;</span> =&gt; 0,</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            <span class="stringliteral">&#39;status&#39;</span> =&gt; <span class="stringliteral">&#39;Unreplied&#39;</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        ),</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        array(<span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%d&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>)</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    );</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="keywordflow">if</span> ($result !== <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        $enquiry_id = $wpdb-&gt;insert_id;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        $cart = WC()-&gt;cart;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>        <span class="keywordflow">if</span> ($cart) {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            <span class="keywordflow">foreach</span> ($cart-&gt;get_cart() as $cart_item_key =&gt; $cart_item) {</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                $product = $cart_item[<span class="stringliteral">&#39;data&#39;</span>];</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                $wpdb-&gt;insert(</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                    $cart_items_table,</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                    array(</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                        <span class="stringliteral">&#39;enquiry_id&#39;</span> =&gt; $enquiry_id,</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>                        <span class="stringliteral">&#39;product_name&#39;</span> =&gt; $product-&gt;get_name(),</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>                        <span class="stringliteral">&#39;quantity&#39;</span> =&gt; $cart_item[<span class="stringliteral">&#39;quantity&#39;</span>],</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>                        <span class="stringliteral">&#39;sku&#39;</span> =&gt; $product-&gt;get_sku()</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>                    ),</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                    array(<span class="stringliteral">&#39;%d&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%d&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>)</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>                );</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>            }</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        error_log(<span class="stringliteral">&#39;Failed to insert form data into database: &#39;</span> . $wpdb-&gt;last_error);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        error_log(<span class="stringliteral">&#39;Data: &#39;</span> . print_r($form_data, <span class="keyword">true</span>));</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    }</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="keywordflow">return</span> $result !== <span class="keyword">false</span>;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>}</div>
</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="foldopen" id="foldopen00141" data-start="{" data-end="}">
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">  141</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">ef_send_notification_email</a>($form_data) {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;EF_Email&#39;</span>)) {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        error_log(<span class="stringliteral">&#39;EF_Email class not found&#39;</span>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    }</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    $result = <a class="code hl_function" href="class_e_f___email.html#a539db573164944809bba2249a0e2f341">EF_Email::send_notification_email</a>($form_data);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="keywordflow">if</span> (!$result) {</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        error_log(<span class="stringliteral">&#39;Failed to send notification email. Error: &#39;</span> . <a class="code hl_function" href="class_e_f___email.html#aee6c90f2128e575740685ec3b813140a">EF_Email::get_last_error</a>());</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordflow">return</span> $result;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>}</div>
</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="foldopen" id="foldopen00153" data-start="{" data-end="}">
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a75befcfbe10fb269f8aa92f5aeae6e4a">  153</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#a75befcfbe10fb269f8aa92f5aeae6e4a">ef_get_email_content</a>($form_data) {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    ob_start();</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    include(<a class="code hl_variable" href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a> . <span class="stringliteral">&#39;emails/enquiry-notification-template.php&#39;</span>);</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="keywordflow">return</span> ob_get_clean();</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>}</div>
</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="foldopen" id="foldopen00159" data-start="{" data-end="}">
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a9d3e1fd403ae0b51ab19003b4ec2edd0">  159</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#a9d3e1fd403ae0b51ab19003b4ec2edd0">ef_sanitize_form_data</a>($form_data) {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keywordflow">return</span> array(</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="stringliteral">&#39;subject&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;subject&#39;</span>]),</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="stringliteral">&#39;content&#39;</span> =&gt; sanitize_textarea_field($form_data[<span class="stringliteral">&#39;content&#39;</span>]),</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="stringliteral">&#39;name&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;name&#39;</span>]),</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="stringliteral">&#39;company&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;company&#39;</span>]),</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="stringliteral">&#39;email&#39;</span> =&gt; sanitize_email($form_data[<span class="stringliteral">&#39;email&#39;</span>]),</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="stringliteral">&#39;phone&#39;</span> =&gt; sanitize_text_field($form_data[<span class="stringliteral">&#39;phone&#39;</span>]),</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    );</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>}</div>
</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="foldopen" id="foldopen00170" data-start="{" data-end="}">
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#aadc8ae2dec7a6f047f34addde5ccf10f">  170</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#aadc8ae2dec7a6f047f34addde5ccf10f">ef_test_form_submission</a>($form_data) {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">// Sanitize the form data</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    $sanitized_data = <a class="code hl_function" href="ef-functions_8php.html#a9d3e1fd403ae0b51ab19003b4ec2edd0">ef_sanitize_form_data</a>($form_data);</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">// Validate the sanitized data</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    $errors = <a class="code hl_function" href="ef-functions_8php.html#a42c092d9cd75e88e9d8646c31e5e4bf6">ef_validate_form_data</a>($sanitized_data);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordflow">if</span> (!empty($errors)) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Submission failed: &quot;</span> . implode(<span class="stringliteral">&#39;, &#39;</span>, $errors);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    }</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="comment">// Actually save the data</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    $saved = <a class="code hl_function" href="ef-functions_8php.html#ace887820ee00c2a6bf5a026d621a308b">ef_save_form_data</a>($sanitized_data);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordflow">if</span> ($saved) {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        <span class="comment">// Attempt to send notification email</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        $email_sent = <a class="code hl_function" href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">ef_send_notification_email</a>($sanitized_data);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        <span class="keywordflow">if</span> ($email_sent) {</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Submission successful: Data saved and notification sent.&quot;</span>;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Submission partially successful: Data saved but notification failed.&quot;</span>;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        }</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Submission failed: Unable to save data&quot;</span>;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>}</div>
</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="foldopen" id="foldopen00197" data-start="{" data-end="}">
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a20376de7367c72554328fcc717433c8f">  197</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#a20376de7367c72554328fcc717433c8f">ef_send_confirmation_email</a>($form_data) {</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;EF_Email&#39;</span>)) {</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        error_log(<span class="stringliteral">&#39;EF_Email class not found&#39;</span>);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    }</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    $result = <a class="code hl_function" href="class_e_f___email.html#a1bf00edc5b137d713df92601e98b1e56">EF_Email::send_confirmation_email</a>($form_data);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="keywordflow">if</span> (!$result) {</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        error_log(<span class="stringliteral">&#39;Failed to send confirmation email to &#39;</span> . $form_data[<span class="stringliteral">&#39;email&#39;</span>] . <span class="stringliteral">&#39;. Error: &#39;</span> . <a class="code hl_function" href="class_e_f___email.html#aee6c90f2128e575740685ec3b813140a">EF_Email::get_last_error</a>());</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    }</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">return</span> $result;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="foldopen" id="foldopen00210" data-start="{" data-end="}">
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#a42c092d9cd75e88e9d8646c31e5e4bf6">  210</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#a42c092d9cd75e88e9d8646c31e5e4bf6">ef_validate_form_data</a>($form_data) {</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    $errors = array();</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="comment">// Example validation: Check if email is valid</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keywordflow">if</span> (!is_email($form_data[<span class="stringliteral">&#39;email&#39;</span>])) {</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        $errors[] = <span class="stringliteral">&#39;Invalid email address.&#39;</span>;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="comment">// Add more validation rules as needed</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="comment">// Example: Check if phone number is numeric</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="keywordflow">if</span> (!is_numeric($form_data[<span class="stringliteral">&#39;phone&#39;</span>])) {</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        $errors[] = <span class="stringliteral">&#39;Phone number must be numeric.&#39;</span>;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    }</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">return</span> $errors;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>}</div>
</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="foldopen" id="foldopen00227" data-start="{" data-end="}">
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#ac76e603284d82728794da99a893f2328">  227</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#ac76e603284d82728794da99a893f2328">ef_check_new_entries</a>() {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    global $wpdb;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    $table_name = $wpdb-&gt;prefix . <span class="stringliteral">&#39;ef_enquiries&#39;</span>;</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="comment">// Fetch entries that haven&#39;t been processed yet</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    $new_entries = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT * FROM $table_name WHERE processed = 0&quot;</span>);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keywordflow">foreach</span> ($new_entries as $entry) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="comment">// Send emails</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <a class="code hl_function" href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">ef_send_notification_email</a>((array)$entry);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <a class="code hl_function" href="ef-functions_8php.html#a20376de7367c72554328fcc717433c8f">ef_send_confirmation_email</a>((array)$entry);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        <span class="comment">// Mark as processed</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        $wpdb-&gt;update($table_name, array(<span class="stringliteral">&#39;processed&#39;</span> =&gt; 1), array(<span class="stringliteral">&#39;id&#39;</span> =&gt; $entry-&gt;id));</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    }</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>}</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="comment">// Schedule the event</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="keywordflow">if</span> (!wp_next_scheduled(<span class="stringliteral">&#39;ef_check_new_entries_event&#39;</span>)) {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    wp_schedule_event(time(), <span class="stringliteral">&#39;hourly&#39;</span>, <span class="stringliteral">&#39;ef_check_new_entries_event&#39;</span>);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>}</div>
</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>add_action(<span class="stringliteral">&#39;ef_check_new_entries_event&#39;</span>, <span class="stringliteral">&#39;ef_check_new_entries&#39;</span>);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>add_action(<span class="stringliteral">&#39;woocommerce_checkout_order_processed&#39;</span>, <span class="stringliteral">&#39;ef_save_cart_items&#39;</span>, 10, 1);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="foldopen" id="foldopen00253" data-start="{" data-end="}">
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#aa7e4bcae1adf63d9dd22a081a8fcc8f5">  253</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#aa7e4bcae1adf63d9dd22a081a8fcc8f5">ef_save_cart_items</a>($order_id) {</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keywordflow">if</span> (!class_exists(<span class="stringliteral">&#39;WC_Order&#39;</span>)) {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    }</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    $order = wc_get_order($order_id);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    $cart_items = $order-&gt;get_items();</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    global $wpdb;</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    $cart_items_table = $wpdb-&gt;prefix . <span class="stringliteral">&#39;ef_cart_items&#39;</span>;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="keywordflow">foreach</span> ($cart_items as $item_id =&gt; $item) {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <a class="code hl_variable" href="enquiry-confirmation-template_8php.html#a7e06b51245839e532a5fa55050f46a41">$product_name</a> = $item-&gt;get_name();</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        $quantity = $item-&gt;get_quantity();</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <a class="code hl_variable" href="enquiry-confirmation-template_8php.html#a1f8a61d63e9c6923a5c8e349d69d6f93">$sku</a> = $item-&gt;get_product()-&gt;get_sku();</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        $wpdb-&gt;insert(</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>            $cart_items_table,</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            array(</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                <span class="stringliteral">&#39;enquiry_id&#39;</span> =&gt; $order_id,</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                <span class="stringliteral">&#39;product_name&#39;</span> =&gt; sanitize_text_field(<a class="code hl_variable" href="enquiry-confirmation-template_8php.html#a7e06b51245839e532a5fa55050f46a41">$product_name</a>),</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                <span class="stringliteral">&#39;quantity&#39;</span> =&gt; intval($quantity),</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                <span class="stringliteral">&#39;sku&#39;</span> =&gt; sanitize_text_field(<a class="code hl_variable" href="enquiry-confirmation-template_8php.html#a1f8a61d63e9c6923a5c8e349d69d6f93">$sku</a>)</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>            ),</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>            array(<span class="stringliteral">&#39;%d&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>, <span class="stringliteral">&#39;%d&#39;</span>, <span class="stringliteral">&#39;%s&#39;</span>)</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>        );</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    }</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>}</div>
</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>add_action(<span class="stringliteral">&#39;wp_ajax_update_enquiry_status&#39;</span>, <span class="stringliteral">&#39;update_enquiry_status&#39;</span>);</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="foldopen" id="foldopen00284" data-start="{" data-end="}">
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno"><a class="line" href="ef-functions_8php.html#ad5863d1e2d77858f28223325a838e5f5">  284</a></span><span class="keyword">function</span> <a class="code hl_function" href="ef-functions_8php.html#ad5863d1e2d77858f28223325a838e5f5">update_enquiry_status</a>() {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    global $wpdb;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    $enquiry_id = intval($_POST[<span class="stringliteral">&#39;enquiry_id&#39;</span>]);</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    $status = sanitize_text_field($_POST[<span class="stringliteral">&#39;status&#39;</span>]);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    $table_name = $wpdb-&gt;prefix . <span class="stringliteral">&#39;ef_enquiries&#39;</span>;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    $result = $wpdb-&gt;update($table_name, array(<span class="stringliteral">&#39;status&#39;</span> =&gt; $status), array(<span class="stringliteral">&#39;id&#39;</span> =&gt; $enquiry_id));</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="keywordflow">if</span> ($result !== <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        wp_send_json_success(<span class="stringliteral">&#39;Status updated successfully.&#39;</span>);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        wp_send_json_error(<span class="stringliteral">&#39;Failed to update status in the database.&#39;</span>);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    }</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>}</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span> </div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="comment">// Enqueue styles and scripts</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="keywordflow">if</span> (!function_exists(<span class="stringliteral">&#39;enquiry_form_enqueue_assets&#39;</span>)) {</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="keyword">function</span> enquiry_form_enqueue_assets() {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        wp_enqueue_style(<span class="stringliteral">&#39;enquiry-form-style&#39;</span>, <a class="code hl_variable" href="main_8php.html#aa9a80b01b8b2cd4e229ae759aad802af">ENQUIRY_FORM_URL</a> . <span class="stringliteral">&#39;assets/css/style.css&#39;</span>, array(), <a class="code hl_variable" href="main_8php.html#acc8b4092b0aee2a9389fe0b84e2074dc">ENQUIRY_FORM_VERSION</a>);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        wp_enqueue_script(<span class="stringliteral">&#39;enquiry-form-script&#39;</span>, <a class="code hl_variable" href="main_8php.html#aa9a80b01b8b2cd4e229ae759aad802af">ENQUIRY_FORM_URL</a> . <span class="stringliteral">&#39;assets/js/script.js&#39;</span>, array(<span class="stringliteral">&#39;jquery&#39;</span>), <a class="code hl_variable" href="main_8php.html#acc8b4092b0aee2a9389fe0b84e2074dc">ENQUIRY_FORM_VERSION</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        wp_enqueue_style(<span class="stringliteral">&#39;twentytwentyfour-style&#39;</span>, get_template_directory_uri() . <span class="stringliteral">&#39;/style.css&#39;</span>, array(), wp_get_theme()-&gt;<span class="keyword">get</span>(<span class="stringliteral">&#39;Version&#39;</span>));</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>}</div>
</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="ttc" id="aclass_e_f___email_html_a1bf00edc5b137d713df92601e98b1e56"><div class="ttname"><a href="class_e_f___email.html#a1bf00edc5b137d713df92601e98b1e56">EF_Email\send_confirmation_email</a></div><div class="ttdeci">static send_confirmation_email($form_data)</div><div class="ttdef"><b>Definition</b> <a href="class-ef-email_8php_source.html#l00064">class-ef-email.php:64</a></div></div>
<div class="ttc" id="aclass_e_f___email_html_a539db573164944809bba2249a0e2f341"><div class="ttname"><a href="class_e_f___email.html#a539db573164944809bba2249a0e2f341">EF_Email\send_notification_email</a></div><div class="ttdeci">static send_notification_email($form_data)</div><div class="ttdef"><b>Definition</b> <a href="class-ef-email_8php_source.html#l00024">class-ef-email.php:24</a></div></div>
<div class="ttc" id="aclass_e_f___email_html_aee6c90f2128e575740685ec3b813140a"><div class="ttname"><a href="class_e_f___email.html#aee6c90f2128e575740685ec3b813140a">EF_Email\get_last_error</a></div><div class="ttdeci">static get_last_error()</div><div class="ttdef"><b>Definition</b> <a href="class-ef-email_8php_source.html#l00104">class-ef-email.php:104</a></div></div>
<div class="ttc" id="aclass_e_f___logger_html_a1b76ab17849fbe5c74c4ec26534f4d9a"><div class="ttname"><a href="class_e_f___logger.html#a1b76ab17849fbe5c74c4ec26534f4d9a">EF_Logger\log</a></div><div class="ttdeci">static log($message, $level=self::INFO, $context=array())</div><div class="ttdef"><b>Definition</b> <a href="class-ef-logger_8php_source.html#l00031">class-ef-logger.php:31</a></div></div>
<div class="ttc" id="aclass_e_f___logger_html_a7f79d7b73cfb40bb7855d4260393cc0f"><div class="ttname"><a href="class_e_f___logger.html#a7f79d7b73cfb40bb7855d4260393cc0f">EF_Logger\ERROR</a></div><div class="ttdeci">const ERROR</div><div class="ttdef"><b>Definition</b> <a href="class-ef-logger_8php_source.html#l00007">class-ef-logger.php:7</a></div></div>
<div class="ttc" id="aclass_e_f___logger_html_ad0c7ccd2f8b92a760391d21d0ec7b339"><div class="ttname"><a href="class_e_f___logger.html#ad0c7ccd2f8b92a760391d21d0ec7b339">EF_Logger\WARNING</a></div><div class="ttdeci">const WARNING</div><div class="ttdef"><b>Definition</b> <a href="class-ef-logger_8php_source.html#l00008">class-ef-logger.php:8</a></div></div>
<div class="ttc" id="aclass_e_f___logger_html_af2d1bd27ecbe33ecaadb558404e9c669"><div class="ttname"><a href="class_e_f___logger.html#af2d1bd27ecbe33ecaadb558404e9c669">EF_Logger\INFO</a></div><div class="ttdeci">const INFO</div><div class="ttdef"><b>Definition</b> <a href="class-ef-logger_8php_source.html#l00009">class-ef-logger.php:9</a></div></div>
<div class="ttc" id="aef-functions_8php_html_a20376de7367c72554328fcc717433c8f"><div class="ttname"><a href="ef-functions_8php.html#a20376de7367c72554328fcc717433c8f">ef_send_confirmation_email</a></div><div class="ttdeci">ef_send_confirmation_email($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00197">ef-functions.php:197</a></div></div>
<div class="ttc" id="aef-functions_8php_html_a42c092d9cd75e88e9d8646c31e5e4bf6"><div class="ttname"><a href="ef-functions_8php.html#a42c092d9cd75e88e9d8646c31e5e4bf6">ef_validate_form_data</a></div><div class="ttdeci">ef_validate_form_data($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00210">ef-functions.php:210</a></div></div>
<div class="ttc" id="aef-functions_8php_html_a67e5c2e0d3709064642d7f63ce1b4b10"><div class="ttname"><a href="ef-functions_8php.html#a67e5c2e0d3709064642d7f63ce1b4b10">ef_send_notification_email</a></div><div class="ttdeci">ef_send_notification_email($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00141">ef-functions.php:141</a></div></div>
<div class="ttc" id="aef-functions_8php_html_a75befcfbe10fb269f8aa92f5aeae6e4a"><div class="ttname"><a href="ef-functions_8php.html#a75befcfbe10fb269f8aa92f5aeae6e4a">ef_get_email_content</a></div><div class="ttdeci">ef_get_email_content($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00153">ef-functions.php:153</a></div></div>
<div class="ttc" id="aef-functions_8php_html_a9d3e1fd403ae0b51ab19003b4ec2edd0"><div class="ttname"><a href="ef-functions_8php.html#a9d3e1fd403ae0b51ab19003b4ec2edd0">ef_sanitize_form_data</a></div><div class="ttdeci">ef_sanitize_form_data($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00159">ef-functions.php:159</a></div></div>
<div class="ttc" id="aef-functions_8php_html_aa7e4bcae1adf63d9dd22a081a8fcc8f5"><div class="ttname"><a href="ef-functions_8php.html#aa7e4bcae1adf63d9dd22a081a8fcc8f5">ef_save_cart_items</a></div><div class="ttdeci">ef_save_cart_items($order_id)</div><div class="ttdef"><b>Definition</b> <a href="#l00253">ef-functions.php:253</a></div></div>
<div class="ttc" id="aef-functions_8php_html_aadc8ae2dec7a6f047f34addde5ccf10f"><div class="ttname"><a href="ef-functions_8php.html#aadc8ae2dec7a6f047f34addde5ccf10f">ef_test_form_submission</a></div><div class="ttdeci">ef_test_form_submission($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00170">ef-functions.php:170</a></div></div>
<div class="ttc" id="aef-functions_8php_html_ac76e603284d82728794da99a893f2328"><div class="ttname"><a href="ef-functions_8php.html#ac76e603284d82728794da99a893f2328">ef_check_new_entries</a></div><div class="ttdeci">ef_check_new_entries()</div><div class="ttdef"><b>Definition</b> <a href="#l00227">ef-functions.php:227</a></div></div>
<div class="ttc" id="aef-functions_8php_html_ace887820ee00c2a6bf5a026d621a308b"><div class="ttname"><a href="ef-functions_8php.html#ace887820ee00c2a6bf5a026d621a308b">ef_save_form_data</a></div><div class="ttdeci">ef_save_form_data($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00094">ef-functions.php:94</a></div></div>
<div class="ttc" id="aef-functions_8php_html_ad5863d1e2d77858f28223325a838e5f5"><div class="ttname"><a href="ef-functions_8php.html#ad5863d1e2d77858f28223325a838e5f5">update_enquiry_status</a></div><div class="ttdeci">update_enquiry_status()</div><div class="ttdef"><b>Definition</b> <a href="#l00284">ef-functions.php:284</a></div></div>
<div class="ttc" id="aef-functions_8php_html_af77ad260294f48ad7089cd9514a51128"><div class="ttname"><a href="ef-functions_8php.html#af77ad260294f48ad7089cd9514a51128">ef_process_form_data</a></div><div class="ttdeci">ef_process_form_data($form_data)</div><div class="ttdef"><b>Definition</b> <a href="#l00014">ef-functions.php:14</a></div></div>
<div class="ttc" id="aenquiry-confirmation-template_8php_html_a1f8a61d63e9c6923a5c8e349d69d6f93"><div class="ttname"><a href="enquiry-confirmation-template_8php.html#a1f8a61d63e9c6923a5c8e349d69d6f93">$sku</a></div><div class="ttdeci">$sku</div><div class="ttdef"><b>Definition</b> <a href="enquiry-confirmation-template_8php_source.html#l00055">enquiry-confirmation-template.php:55</a></div></div>
<div class="ttc" id="aenquiry-confirmation-template_8php_html_a7e06b51245839e532a5fa55050f46a41"><div class="ttname"><a href="enquiry-confirmation-template_8php.html#a7e06b51245839e532a5fa55050f46a41">$product_name</a></div><div class="ttdeci">if(!empty($cart_items))($cart_items as $cart_item_key=&gt; $cart_item) $product_name</div><div class="ttdef"><b>Definition</b> <a href="enquiry-confirmation-template_8php_source.html#l00054">enquiry-confirmation-template.php:54</a></div></div>
<div class="ttc" id="amain_8php_html_a8e58b2b5ae1a5dea17dfde6c8237e5f6"><div class="ttname"><a href="main_8php.html#a8e58b2b5ae1a5dea17dfde6c8237e5f6">ENQUIRY_FORM_PATH</a></div><div class="ttdeci">const ENQUIRY_FORM_PATH</div><div class="ttdef"><b>Definition</b> <a href="main_8php_source.html#l00037">main.php:37</a></div></div>
<div class="ttc" id="amain_8php_html_aa9a80b01b8b2cd4e229ae759aad802af"><div class="ttname"><a href="main_8php.html#aa9a80b01b8b2cd4e229ae759aad802af">ENQUIRY_FORM_URL</a></div><div class="ttdeci">const ENQUIRY_FORM_URL</div><div class="ttdef"><b>Definition</b> <a href="main_8php_source.html#l00038">main.php:38</a></div></div>
<div class="ttc" id="amain_8php_html_acc8b4092b0aee2a9389fe0b84e2074dc"><div class="ttname"><a href="main_8php.html#acc8b4092b0aee2a9389fe0b84e2074dc">ENQUIRY_FORM_VERSION</a></div><div class="ttdeci">const ENQUIRY_FORM_VERSION(!defined('ABSPATH'))</div><div class="ttdef"><b>Definition</b> <a href="main_8php_source.html#l00036">main.php:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_46dc8ac68f57394fbc4c170849c8cd59.html">GitHub Projects</a></li><li class="navelem"><a class="el" href="dir_dc0d924a75f365793828bda6b84bb026.html">Enquiry-Form</a></li><li class="navelem"><a class="el" href="dir_ded05162633501f39d67f0a96e8a7dbf.html">includes</a></li><li class="navelem"><a class="el" href="ef-functions_8php.html">ef-functions.php</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
